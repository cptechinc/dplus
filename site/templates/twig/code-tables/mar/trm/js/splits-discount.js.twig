$(function() {
/* =============================================================
	Event Functions
============================================================= */
	$("body").on('focusin', '.order_percent', function(){
		$(this).data('val', $(this).val());
	});

	$("body").on('change', '.discount .days, .discount .day, .discount .discount_date', function(e) {
		var input = $(this);
		var parent = input.closest('.discount');
		discount_feedback(parent, function() {

		});
	});


/* =============================================================
	Event Functions -- Discount
============================================================= */

	$("body").on('change', '.discount_percent', function(e) {
		var input = $(this);
		var row = input.closest('.discount');
		var index = row.data('index');

		if (input.val() == 0) {
			$('.split'+index).find('.invalid-feedback').remove();
			$('.split'+index).find('.day, .days').val(0);
			$('.split'+index).find('.disc_date').val('');
			$('.split'+index).find('.day, .days, .disc_date').prop('disabled', true);
		} else {
			$('.discount_percent').removeClass('is-invalid');
			$('.split'+index).find('.day, .disc_date').prop('disabled', false);
			$('.split'+index).find('.days').removeAttr('disabled');
			$('.split'+index).find('.days').focus();
		}
	});

	$("body").on('change', '.discount input', function(e) {
		var input = $(this);
		var row = input.closest('.discount');
		var index = row.attr("data-index");

		if (input.val() != 0) {
			row.find($('.disc_day, .disc_days')).not(this).val(0);
			row.find($('input.disc_group')).not(this).prop('disabled', true);
			row.find($('.disc_date')).not(this).val('');
		}

		if (input.val() == 0 && row.find('input.disc_group').not(this).val() == 0) {
			row.find($('input.disc_group')).not(this).prop('disabled', false);
		}
	});
});


/* =============================================================
	Supplemental Functions
============================================================= */
function discount_feedback(discountrow, callback) {
	var input_days = discountrow.find('.days');
	var input_day = discountrow.find('.day');
	var input_date = discountrow.find('.disc_date');
	var input_percent = discountrow.find('.discount_percent');
	var valid = false;

	if (input_days.val() == '0' && input_day.val() == '0' && input_date.val() == '') {
		valid = false;
		input_days.removeClass('valid').addClass('is-invalid');
		input_day.removeClass('valid').addClass('is-invalid');
		input_date.removeClass('valid').addClass('is-invalid');
		discountrow.find('.invalid-feedback').remove();
		$('<div class="invalid-feedback show">You must enter days, day, or date for this discount percent</div>').appendTo(discountrow);
	} else {
		valid = true;
		discountrow.find('.invalid-feedback').remove();
		input_percent.removeClass('is-invalid').addClass('valid');
		input_day.removeClass('is-invalid').addClass('valid');
		input_days.removeClass('is-invalid').addClass('valid');
		input_date.removeClass('is-invalid').addClass('valid');
	}
	callback(valid);
}
