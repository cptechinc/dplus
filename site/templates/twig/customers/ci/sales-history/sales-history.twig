{% if json['data'] is empty %}
	{% include 'util/alert.twig' with {'type': 'danger','iconclass': 'fa fa-warning fa-2x', 'title': 'Attention!', 'message': 'No Sales History Found'} %}
{% endif %}

{% for whse in json['data'] %}
	<h4>{{ whse['Whse Name'] }}</h4>

	<table class="table table-striped table-bordered table-sm table-excel" id="{{ whse['Whse Name'] }}">
		<thead></thead>
		<tbody>
			{% for invoice in whse['orders'] %}

				{% for x in 1..blueprint['header']['rowcount'] %}
					{% set attr = ((x == 1) ? 'class=first-txn-row' : '') %}
					<tr {{ attr }}>
						{% set columncount = 0 %}
						{% for i in 1..blueprint['cols'] + 1 %}
							{% set colspan = 0 %}
							{% if blueprint['header']['rows'][x]['columns'][i] %}
								{% set column = blueprint['header']['rows'][x]['columns'][i] %}
								{% set colspan = column['col-length'] %}
								<td colspan="{{ colspan }}" class="{{ module_formatter.get_justifyclass(column['data-justify']) }}">
									<span class="font-weight-bold">{{ column['label'] }}</span> {{ module_formatter.format_celldata(invoice, column) }}
									{% if column['id'] == 'Invoice Number' %}
										{% set ordn = invoice['Ordn'] %}
										{% set custID = json['custid'] %}
										{% if document_management.count_saleshistorydocuments(ordn) %}
											<a href="{{ page.documentsview_salesorder(custID, ordn)}}" class="text-success" title="View Documents for Invoice # {{ invoice['Invoice Number'] }}">
												<i class="fa fa-file-text" aria-hidden="true"></i> <span class="sr-only">View Documents for Invoice # {{ invoice['Invoice Number'] }}</span>
											</a>
										{% endif %}
									{% endif %}
								</td>
							{% else %}
								{% if columncount < blueprint['cols'] %}
									{% set colspan = 1 %}
									<td></td>
								{% endif %}
							{% endif %}
							{% set columncount = columncount + colspan %}
						{% endfor %}
					</tr>
				{% endfor %}
				{% for x in 1..blueprint['detail']['rowcount'] %}
					<tr>
						{% set columncount = 0 %}
						{% for i in 1..blueprint['cols'] + 1 %}
							{% set colspan = 0 %}
							{% if blueprint['detail']['rows'][x]['columns'][i] %}
								{% set column = blueprint['detail']['rows'][x]['columns'][i] %}
								{% set colspan = column['col-length'] %}
								<td colspan="{{ colspan }}" class="font-weight-bold {{ module_formatter.get_justifyclass(column['data-justify']) }}">
									{{ column['label'] }}
								</td>
							{% else %}
								{% if columncount < blueprint['cols'] %}
									{% set colspan = 1 %}
									<td></td>
								{% endif %}
							{% endif %}
							{% set columncount = columncount + colspan %}
						{% endfor %}
					</tr>
				{% endfor %}

				{% for detail in invoice['details'] %}

					{% for x in 1..blueprint['detail']['rowcount'] %}
						<tr>
							{% set columncount = 0 %}
							{% for i in 1..blueprint['cols'] + 1 %}
								{% set colspan = 0 %}
								{% if blueprint['detail']['rows'][x]['columns'][i] %}
									{% set column = blueprint['detail']['rows'][x]['columns'][i] %}
									{% set colspan = column['col-length'] %}
									<td colspan="{{ colspan }}" class="{{ module_formatter.get_justifyclass(column['data-justify']) }}">
										{{ module_formatter.format_celldata(detail, column) }}
									</td>
								{% else %}
									{% if columncount < blueprint['cols'] %}
										{% set colspan = 1 %}
										<td></td>
									{% endif %}
								{% endif %}
								{% set columncount = columncount + colspan %}
							{% endfor %}
						</tr>
					{% endfor %}
					{% if detail['lotserial']|length > 0 %}
						{% for x in 1..blueprint['lotserial']['rowcount'] %}
							<tr>
								{% set columncount = 0 %}
								{% for i in 1..blueprint['cols'] + 1 %}
									{% set colspan = 0 %}
									{% if blueprint['lotserial']['rows'][x]['columns'][i] %}
										{% set column = blueprint['lotserial']['rows'][x]['columns'][i] %}
										{% set colspan = column['col-length'] %}
										<td colspan="{{ colspan }}" class="font-weight-bold {{ module_formatter.get_justifyclass(column['data-justify']) }}">
											{{ column['label'] }}
										</td>
									{% else %}
										{% if columncount < blueprint['cols'] %}
											{% set colspan = 1 %}
											<td></td>
										{% endif %}
									{% endif %}
									{% set columncount = columncount + colspan %}
								{% endfor %}
							</tr>
						{% endfor %}
					{% endif %}
					{% for lot in detail['lotserial'] %}
						{% for x in 1..blueprint['lotserial']['rowcount'] %}
							<tr>
								{% set columncount = 0 %}
								{% for i in 1..blueprint['cols'] + 1 %}
									{% set colspan = 0 %}
									{% if blueprint['lotserial']['rows'][x]['columns'][i] %}
										{% set column = blueprint['lotserial']['rows'][x]['columns'][i] %}
										{% set colspan = column['col-length'] %}
										<td colspan="{{ colspan }}" class="{{ module_formatter.get_justifyclass(column['data-justify']) }}">
											{{ module_formatter.format_celldata(lot, column) }}
										</td>
									{% else %}
										{% if columncount < blueprint['cols'] %}
											{% set colspan = 1 %}
											<td></td>
										{% endif %}
									{% endif %}
									{% set columncount = columncount + colspan %}
								{% endfor %}
							</tr>
						{% endfor %}
					{% endfor %}
					{% for ordernote in detail['detailnotes'] %}
						<tr class="show-notes">
							{% for i in 1..blueprint['cols'] - 1 %}
								{% if i == 2 %}
									<td colspan='2'>{{ ordernote['Detail Notes'] }}</td>
								{% else %}
									<td></td>
								{% endif %}
							{% endfor %}
						</tr>
					{% endfor %}

				{% endfor %}

				{% for x in 1..blueprint['total']['rowcount'] %}
					<tr>
						{% set columncount = 0 %}
						{% for i in 1..blueprint['cols'] + 1 %}
							{% set colspan = 0 %}
							{% if blueprint['total']['rows'][x]['columns'][i] %}
								{% set column = blueprint['total']['rows'][x]['columns'][i] %}
								{% set colspan = column['col-length'] %}
								<td colspan="{{ colspan }}" class="{{ module_formatter.get_justifyclass(column['data-justify']) }}">
									<span class="font-weight-bold">{{ column['label'] }}</span> {{ module_formatter.format_celldata(invoice['totals'], column) }}
								</td>
							{% else %}
								{% if columncount < blueprint['cols'] %}
									{% set colspan = 1 %}
									<td></td>
								{% endif %}
							{% endif %}
							{% set columncount = columncount + colspan %}
						{% endfor %}
					</tr>
				{% endfor %}
				{% for shipment in invoice['shipments'] %}
					{% for x in 1..blueprint['shipments']['rowcount'] %}
						<tr>
							{% set columncount = 0 %}
							{% for i in 1..blueprint['cols'] + 1 %}
								{% set colspan = 0 %}
								{% if blueprint['shipments']['rows'][x]['columns'][i] %}
									{% set column = blueprint['shipments']['rows'][x]['columns'][i] %}
									{% set colspan = column['col-length'] %}
									<td colspan="{{ colspan }}" class="{{ module_formatter.get_justifyclass(column['data-justify']) }}">
										{{ module_formatter.format_celldata(shipment, column['label']) }}
									</td>
								{% else %}
									{% if columncount < blueprint['cols'] %}
										{% set colspan = 1 %}
										<th></th>
									{% endif %}
								{% endif %}
								{% set columncount = columncount + colspan %}
							{% endfor %}
						</tr>
					{% endfor %}
				{% endfor %}

			{% endfor %}

		</tbody>
	</table>
{% endfor %}
