{#
	var                    Description / Instance of
	-------------------------------------------------
	page                   ProcessWire\Page
	item                   ItemMasterItem
	m_costing              module ItmCosting
	itm                    module Itm
#}
<form action="{{ input.url() }}" class="mb-3" id="item-costing-form" method="post">
	<input type="hidden" name="itemID" value="{{ item.itemid }}">
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="uom_purchase">Purchase UoM</label>
		</div>
		<div class="col-sm-8">
			<select name="uom_purchase" class="custom-select custom-select-sm" id="uom_purchase">
				{% for uom in m_costing.get_uom_purchases() %}
					<option value="{{ uom.code }}" data-conversion="{{ uom.conversion }}" {{ uom.code == item.unitofmpurchase.code ? 'selected' : '' }}>
						{{ uom.code }} - {{ uom.description }}
					</option>
				{% endfor %}
			</select>
		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="standardcost">Standard Cost</label>
		</div>
		<div class="col-sm-8">
			<div class="row mb-2">
				<div class="col-sm-8">
					{% include 'util/bootstrap/form/input-group.twig' with {
							'inputgroup': {
								'type': 'append',
								'size': 'sm',
								'input': {
									'type': 'number',
									'name': 'standardcost',
									'value': (item.standardcost * item.unitofmpurchase.conversion)|number_format(m_costing.getConfigPo().decimal_places_cost),
									'addclasses': ['text-right']
								},
								'span': {
									'text': item.unitofmpurchase.code|spacepad(m_costing.getUomCodeLength())|raw,
									'addclasses': ['text-monospace', 'uom-purchase-display']
								}
							}
						}
					%}
				</div>
				<div class="col-sm-4">
					<p class="form-control-plaintext form-control-sm">{{ item.date_laststandardcost ? item.date_laststandardcost|convertdate : '' }}</p>
				</div>
			</div>
			<div class="row">
				<div class="col-sm-8">
					{% include 'util/bootstrap/form/input-group.twig' with {
							'inputgroup': {
								'type': 'append',
								'size': 'sm',
								'addclasses': [
									'collapse',
									item.unitofmpurchase.code != 'EACH' ? 'show' : ''
								],
								'attributes': {
									'id': 'standardcost-each',
									'readonly': true
								},
								'input': {
									'value': item.standardcost|number_format(m_costing.configs.po.decimal_places_cost),
									'addclasses': ['text-right']
								},
								'span': {
									'text': 'EACH',
									'addclasses': ['text-monospace']
								}
							}
						}
					%}
				</div>
			</div>
		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="standardcostbasedon">Based On</label>
		</div>
		<div class="col-sm-8">
			<div class="row">
				<div class="col-sm-8">
					{% include 'util/form/select.twig' with {
							'name':          'standardcostbasedon',
							'id':            'standardcostbasedon',
							'selected_value': item.standardcostbasedon,
							'options':       m_costing.get_standardcost_basedon_options(),
							'show_value': true,
						}
					%}
				</div>
			</div>

		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="lastcost">Last Cost</label>
		</div>
		<div class="col-sm-8">
			<div class="row mb-2">
				<div class="col-sm-8">
					{% include 'util/bootstrap/form/input-group.twig' with {
							'inputgroup': {
								'type': 'append',
								'size': 'sm',
								'attributes': {'readonly': true},
								'input': {
									'name': 'lastcost',
									'value': item.lastcost|number_format(m_costing.configs.po.decimal_places_cost),
									'addclasses': ['text-right']
								},
								'span': {
									'text': item.unitofmpurchase.code|spacepad(m_costing.getUomCodeLength())|raw,
									'addclasses': ['text-monospace', 'uom-purchase-display']
								}
							}
						}
					%}
				</div>
				<div class="col-sm-4">
					<p class="form-control-plaintext">{{ item.date_lastcost ? item.date_lastcost|convertdate : '' }}</p>
				</div>
			</div>
			{% if item.unitofmpurchase.code != 'EACH' %}
				<div class="row">
					<div class="col-sm-8">
						{% include 'util/bootstrap/form/input-group.twig' with {
								'inputgroup': {
									'type': 'append',
									'size': 'sm',
									'attributes': {'readonly': true},
									'input': {
										'name': 'lastcosteach',
										'value': (item.lastcost / item.unitofmpurchase.conversion)|number_format(m_costing.configs.po.decimal_places_cost),
										'addclasses': ['text-right']
									},
									'span': {
										'text': 'EACH',
										'addclasses': ['text-monospace']
									}
								}
							}
						%}
					</div>
				</div>
			{% endif %}
		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="buyer">{{ m_costing.is_buyercontrol_item() ? 'Buyer' : 'N/A'}}</label>
		</div>
		<div class="col-sm-8">
			{% if m_costing.is_buyercontrol_item() %}
				<select name="buyer" id="buyer" class="custom-select custom-select-sm">
					<option value=""></option>
					{% for buyer in m_costing.get_ap_buyers() %}
						<option value="{{ buyer.code }}" {{ buyer.code == item.buyer ? 'selected' : ''}}>
							{{ buyer.code }} - {{ buyer.description }}
						</option>
					{% endfor %}
				</select>
			{% endif %}
		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="minmargin">Min Margin</label>
		</div>
		<div class="col-sm-8">
			<div class="row">
				<div class="col-sm-5">
					<input type="text" class="form-control form-control-sm text-right" name="minmargin" id="minmargin" value="{{ item.minmargin|number_format(4) }}">
				</div>
				<div class="col-sm-7">
					<div class="row">
						<div class="col-sm-5">
							<label for="minmarginbase">Based On</label>
						</div>
						<div class="col-sm-7">
							<select name="minmarginbase" id="minmarginbase" class="form-control form-control-sm">
								{% for code, label in m_costing.getMinMarginBasedOnOptions() %}
									<option value="{{ code }}" {{ code == item.minmarginbase ? 'selected' : ''}}>
										{{ code }} - {{ label|capitalize }}
									</option>
								{% endfor %}
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="form-group row">
		<div class="col-sm-4">
			<label for="qty_purchase_carton">{{ m_costing.appcustID == 'LINDST' ? 'Carton Qty' : 'N/A'}}</label>
		</div>
		<div class="col-sm-8">
			{% if m_costing.appcustID == 'LINDST' %}
				<input type="number" class="form-control form-control-sm text-right" name="qty_purchase_carton" id="qty_purchase_carton" value="{{ item.qty_purchase_carton }}">
			{% endif %}
		</div>
	</div>
	<div class="d-flex justify-content-between align-items-center">
		{#
			Only show Edit Actions if the Item is
			1. Locked for editing by the User
		#}
		{% if itm.recordlocker.userHasLocked(item.itemid) %}
			<button type="submit" class="btn btn-success" name="action" value="update-itm-costing">
				<i class="fa fa-floppy-o" aria-hidden="true"></i> Save
			</button>
		{% endif %}
		<a href="{{ page.itmUrl(item.itemid) }}" class="btn btn-warning">
			<i class="fa fa-times" aria-hidden="true"></i> Close
		</a>
	</div>
</form>
